## CRUD для ведения таблицы Users (Пользователи)

- [X] Создание пользователя (регистрация)
- [X] Получить всех пользователей
- [X] Удаление пользователя (by email)
- [X] Изменение данных пользователя (by email)
- [X] Редактирование собственного профиля
  
- [X] [Коллекция для работы с end points для Postman v2.0](../dmc.core.postman_collection_21112021.json)


#### Создание пользователя 

```
ROLES (all)

POST: http://localhost:5000/auth/registration
{
    "email": "volk@mail.ru",
    "password": "volk",
    "name": "Татьянапп",
    "city": "Самара",
    "address": "Силовая ул., дом 4, кв. 144",
    "desc": "Дополнительное описание",
    "phone": "+7 (901) 333-54-02",
    "birthday": "05.12.1984"
}
```
Поля указанные ниже не могут быть созданы при регистрации. Они изменяются уже администратором, входе жизни данного пользователя.
```
"role": "customer",
"isDelete":false
```
Выходными данными являются token пользователя. Пользователь, который обращается к endpoints без token, считается не зарегистрированным в системе соответственно, не имеет доступа.

Пример выходных данных endpoint регистрация:

```
[
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InAyQG1haWwucnUiLCJpZCI6Nywicm9sZSI6ImN1c3RvbWVyIiwiaWF0IjoxNjM2MzE3MzQ5LCJleHAiOjE2MzY0MDM3NDl9.-mCBZ_MphTUjN0J1gXUMPxNQOl5P2QJMz92GspS53QA"
]
```

#### Получить всех пользователей

```
ROLES (admin)

GET: http://localhost:5000/users
```
Данных для отправки в этом запросе нет. Мы сможем получить от системы положительный ответ, только если пользователь авторизован и имеет token, а также пользователь имеет права admin. Также в ходе обсуждения было решено убрать поле password, так как в этой информации нет необходимости.

Пример выходных данных endpoint "Получить всех пользователей":

```
[
    {
        "email": "q14554@mail.ru",
        "name": "Татьянапп",
        "city": null,
        "address": "Силовая ул., дом 4, кв. 144",
        "desc": "Дополнительное описание",
        "phone": "+7 (901) 3332-54-02",
        "birthday": "1984-05-11T19:00:00.000Z",
        "role": "customer",
        "isDelete": false,
        "lastVisit": null,
        "createdAt": "2021-11-07T20:21:37.000Z",
        "updatedAt": "2021-11-07T20:21:37.000Z",
        "deletedAt": null
    },
    {
        "email": "q145354@mail.ru",
        "name": "Татьянапп",
        "city": null,
        "address": null,
        "desc": "Дополнительное описание",
        "phone": "+7 (901) 3332-5-02",
        "birthday": "1984-05-11T19:00:00.000Z",
        "role": "customer",
        "isDelete": false,
        "lastVisit": null,
        "createdAt": "2021-11-07T20:22:25.000Z",
        "updatedAt": "2021-11-07T20:22:25.000Z",
        "deletedAt": null
    }
]
```

#### Удаление пользователя (by email)

```
ROLES (admin)

DELETE: http://localhost:5000/users/v@mail.ru
```

В качестве входящих данных через url передается адрес электронной почты пользователя которого необходимо удалить.

Если пользователь удален успешно, то в базе данных в таблице пользователей мы ставим isDelete = true, а также отмечаем дату удаления пользователя deletedAt.

В качестве выходных данных система выдает 1 или 0 (если строка была удалена то 1, если по какой-то причине удалить не удалось то 0).

Удалить может только авторизованный пользователь с правами администратора.

Пример выходных данных endpoint "Удаление пользователя":

```
[
    1
]
```

#### Изменение данных пользователя (by email)

```
ROLES (admin)

PATCH: http://localhost:5000/users/q145354@mail.ru

```

В качестве входящих данных через url передается адрес электронной почты пользователя данные которого необходимо отредактировать.

Удаленный ранее пользователь не может быть отредактирован.

Если данные пользователя изменены успешно, то в базе данных в таблице пользователей меняются те данные, которые мы передали для изменения update-user.dto.ts (UpdateUserDto), а также меняется запись updateAt.

```
{
    "address": "Sylovaya 4-144"
}
```

В качестве выходных данных система выдает 1 или 0 (если запись была изменена то 1, если по какой-то причине изменить не удалось то 0).

Изменить запись может только авторизованный пользователь с правами администратора.

Пример выходных данных endpoint "Изменение данных пользователя (by email)":
```
[
    1
]
```

#### Редактирование собственного профиля

```
ROLES (all)

PATCH: http://localhost:5000/users
```
Каждый авторизованный пользователь может измениь свои данные, если он не является удаленным.

Роль пользователь себе изменить не может.

Пример выходных данных endpoint "Редактирование собственного профиля":
```
[
    1
]
```

